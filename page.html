<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>Таблица остатков</title>
    <style>
        body {
            font-family: sans-serif;
            margin: 0;
            padding: 0;
        }
        table {
            border-collapse: collapse;
            width: 100%;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 6px 8px;
            text-align: left;
        }
        thead {
            background: #f4f4f4;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        #loading {
            text-align: center;
            padding: 10px;
        }
    </style>
</head>
<body>

<div>
    <table>
        <thead>
        <tr>
            <th>№</th>
            <th>Наименование</th>
            <th>Категория</th>
            <th>Ед. изм.</th>
            <th>Остаток нач.</th>
            <th>Приход (кол-во)</th>
            <th>Приход (сумма)</th>
            <th>Расход (кол-во)</th>
            <th>Расход (сумма)</th>
            <th>Остаток кон.</th>
            <th>Сумма кон.</th>
        </tr>
        </thead>
        <tbody id="table-body"></tbody>
    </table>
    <div id="loading">Загрузка данных...</div>
</div>

<script>
    //const API_URL = 'https://lk.master-check.kz/api/cus/item'; // замени на свой URL
    const API_URL = 'http://localhost:4060/api/cus/item'; // замени на свой URL
    const tableBody = document.getElementById('table-body');
    const loading = document.getElementById('loading');

    async function fetchData() {
        loading.textContent = 'Загрузка...';

        try {
            const myHeaders = new Headers();
            myHeaders.append("Content-Type", "application/json");

            const raw = JSON.stringify({
                "action": "testTbs",
                "data": {
                    "dateStart": "2018-01-01",
                    "dateEnd": "2025-05-15",
                    "filters": {
                        "affiliate": "4ef6a6e8-fbe1-4d87-b081-a11520db2c17",
                        "cateringpoint": "21657090-d4e1-4516-83c5-c01ea62a2acc",
                        "storage": "3e03eb79-de2e-4a44-9053-a68dde1626b0",
                        "sort": "code"
                    }
                }
            });

            const requestOptions = {
                method: "POST",
                headers: myHeaders,
                body: raw,
                redirect: "follow"
            };

            const response = await fetch(API_URL, requestOptions);
            const result = await response.json();

            if (!Array.isArray(result.data)) {
                loading.textContent = 'Нет данных';
                return;
            }

            loading.textContent = ''; // убираем текст

            result.data.forEach((item, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item.nomenclature.r}</td>
                    <td>${item.nomenclature.f}</td>
                    <td>${item.measure.r}</td>
                    <td>${item.balance_quantity_start}</td>
                    <td>${item.turnover_quantity_in}</td>
                    <td>${item.turnover_sum_in}</td>
                    <td>${item.turnover_quantity_out}</td>
                    <td>${item.turnover_sum_out}</td>
                    <td>${item.balance_quantity_end}</td>
                    <td>${item.balance_sum_end}</td>
                `;
                tableBody.appendChild(row);
            });

        } catch (error) {
            console.error(error);
            loading.textContent = 'Ошибка загрузки';
        }
    }

    // Загружаем один раз
    fetchData();
</script>
</body>
</html>
